<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= article.title %> | MyBlog</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <%- include('partials/navbar.ejs') %>

  <div class="container my-5">
    <!-- Article Section -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h2 class="card-title"><%= article.title %></h2>
        <h6 class="text-muted mb-3">
          Posted by <strong><%= article.author.username %></strong> 
          (<%= article.author.email %>)
        </h6>
        <p class="card-text fs-5"><%= article.body %></p>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">
        Comments
      </div>
      <div class="card-body">
        <% if(article.comments.length === 0) { %>
          <p class="text-muted">No comments yet. Be the first to comment!</p>
        <% } else { %>
          <ul class="list-group list-group-flush">
            <% article.comments.forEach(comment => { %>
              <li class="list-group-item">
                <div class="fw-bold"><%= comment.author.username %></div>
                <div><%= comment.body %></div>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </div>
    </div>

    <% if(currentUser) { %> 
    <!-- Add Comment-->
    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h5 class="card-title">Add a Comment</h5>
        <form action="/article/<%= article._id %>/comments" method="POST">
          <div class="mb-3">
            <textarea class="form-control" name="body" rows="3" placeholder="What are your thoughts?" required></textarea>
          </div>
          <button type="submit" class="btn btn-success">Comment</button>
        </form>
      </div>
    </div>
    <% } else{ %> 
      <div>
        <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h5 class="card-title">Login to Comment</h5>
        <form action = '/users/login' method="get">
          <input type = "submit" value = "Login" class = "btn btn-success"> 
        </form>
      </div>
    </div>
      </div>
      <% } %> 

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>